<pre>
 blog notes

-- what does it mean

what does trending mean; 
- the frequency of event in some time period outside normal
- c.f. outliers
- two images; one of smooth trend up, one with salt and pepper noise

-- the data

tweets about cheese for a period 20100125_2010022; 
436e3 entries / 27days
=> 16e3 a day

extract tweet text (these gzips are full of partial records thus thou shalt redirect json parsing to dev null)
(see run.sh)

first of all how many tweets per hour over this time? (678 entries)
<img src="tweets_over_day.60.nonaggregated.png"/>

what trending can we do on this timeseries?
how do we decide give a new value whether it respresents a trend?

TODO: REMOVE OUTLIERS!!!

1. mean and std dev over entire set

one simple way is compare the value to the historical mean. to make the comparison robust to 
normal flucuenation we compare to mean +/- 2x std dev

<img src="tweets_over_day.60.trending.png"/>
<img src="tweets_over_day.60.trending.zoom.png"/>

this gives us a model for the entire dataset; simplest

2. mean and std dev; compared to this time in previous days

makes each time series much smoother; but not as good at predicting the overall trend.
perhaps this needs to be more than 2x the std dev??
it's getting trends on the downways slope. this is ok (?)

<img src="tweets_over_day.60.periodic_trending.png"/>
<img src="tweets_over_day.60.periodic_trending.zoom.png"/>

how about with a sliding window, with as little as 10 previous numbers?
suprisingly, not too different. i guess this indicates that compared 
to same time of day the data is quite stable.

<img src="tweets_over_day.60.periodic_trending.sliding.png"/>
<img src="tweets_over_day.60.periodic_trending.sliding.zoom.png"/>

slot 9 - low point
slot 22 - high point

<img src="tweets_over_day.60.hi_low_trending.png"/>

this gives us model per 1hr chunk of the day; works well for values which are 'trending' even though the values are on the downturn

3. mean and std dev; per term

break down in terms in 1/2/3 grams

250e3 uniq 1grams; 64% of which are uniq
1.5e6 uniq 2grams; 75% of which are uniq
3.1e6 uniq 3grams; 86% of which are uniq


#4 22532 grilled cheese
<img src="tweets_over_day.60.grilledcheese.trending.png"/>
<!--<img src="tweets_over_day.60.grilledcheese.trending.zoom.png"/>-->

most of the spikes are unexplainable but some are from a single user...

poor fangirl @rachelljonas spent 10 minutes tweeting like crazy trying to get the attention of @nickjonas (some popstar i've never heard of)
and bumped up grilled cheese for a single timeslot

Wed Feb 03 23:44:57 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:44:59 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco??
Wed Feb 03 23:45:03 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :)
Wed Feb 03 23:45:07 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :0
Wed Feb 03 23:45:11 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :d
Wed Feb 03 23:45:17 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :)
Wed Feb 03 23:45:23 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :d :d
Wed Feb 03 23:45:27 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :) :)
Wed Feb 03 23:45:33 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :) :) :) :)
Wed Feb 03 23:45:36 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :p
Wed Feb 03 23:45:41 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :s
Wed Feb 03 23:45:44 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?:)
Wed Feb 03 23:45:50 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? =)
Wed Feb 03 23:45:56 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? =d
Wed Feb 03 23:46:04 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? =p
Wed Feb 03 23:46:34 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? .
Wed Feb 03 23:46:37 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco
Wed Feb 03 23:46:42 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco..
Wed Feb 03 23:46:45 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?????
Wed Feb 03 23:46:50 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco??????
Wed Feb 03 23:46:55 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?????????????
Wed Feb 03 23:46:59 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco???????????
Wed Feb 03 23:47:05 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :) :) ?
Wed Feb 03 23:47:13 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?!?!?
Wed Feb 03 23:47:18 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?????!
Wed Feb 03 23:47:22 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco???????
Wed Feb 03 23:47:27 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco???????????????????
Wed Feb 03 23:47:32 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?????????????????????????????
Wed Feb 03 23:47:36 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco??????????????????????????????
Wed Feb 03 23:47:47 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco???????????????
Wed Feb 03 23:47:53 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco??????????????
Wed Feb 03 23:47:56 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?!
Wed Feb 03 23:48:02 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :-)
Wed Feb 03 23:48:10 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :) :) :)
Wed Feb 03 23:48:16 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):):):):):d
Wed Feb 03 23:48:23 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):):):):):):):)
Wed Feb 03 23:48:27 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:48:36 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ;)
Wed Feb 03 23:48:43 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ;p
Wed Feb 03 23:48:48 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :0
Wed Feb 03 23:48:54 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :o
Wed Feb 03 23:48:59 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :s
Wed Feb 03 23:49:02 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :*
Wed Feb 03 23:49:09 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :&gt;
Wed Feb 03 23:49:20 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :&gt; &lt;----twitter bird :)
Wed Feb 03 23:49:24 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??
Wed Feb 03 23:49:28 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ???
Wed Feb 03 23:49:32 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ?????
Wed Feb 03 23:49:36 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?? ? ?
Wed Feb 03 23:49:39 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ?
Wed Feb 03 23:49:51 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ?? ? ? ?
Wed Feb 03 23:49:57 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??? :0
Wed Feb 03 23:50:01 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:50:06 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?@nickjonas who would win in a fight, a grilled cheese or a taco?&gt;
Wed Feb 03 23:50:11 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?@nickjonas who would win in a fight, a grilled cheese or a taco? :)
Wed Feb 03 23:50:33 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :))
Wed Feb 03 23:50:37 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco??? ?
Wed Feb 03 23:50:40 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ? ?
Wed Feb 03 23:50:43 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ? ? ?
Wed Feb 03 23:50:52 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?? ? ?
Wed Feb 03 23:50:56 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ???
Wed Feb 03 23:50:59 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? /? ?
Wed Feb 03 23:51:04 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? '
Wed Feb 03 23:51:06 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??
Wed Feb 03 23:51:11 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? &gt;&gt; &gt;
Wed Feb 03 23:51:17 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??? ?
Wed Feb 03 23:51:22 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??? / ?
Wed Feb 03 23:51:25 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ?/
Wed Feb 03 23:51:30 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?&gt;&gt;&gt; ?
Wed Feb 03 23:51:34 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco???.?
Wed Feb 03 23:51:37 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? /?
Wed Feb 03 23:51:42 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?//.
Wed Feb 03 23:51:46 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?//
Wed Feb 03 23:51:52 +0000 2010	rachelljonas	//@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:51:57 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? &lt;3
Wed Feb 03 23:52:11 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!
Wed Feb 03 23:52:16 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!
Wed Feb 03 23:52:20 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!
Wed Feb 03 23:52:24 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!
Wed Feb 03 23:52:34 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!
Wed Feb 03 23:52:37 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!!!!!!!!!
Wed Feb 03 23:52:43 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!!!!!!!
Wed Feb 03 23:52:47 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!!!!!!!!!!!!!
Wed Feb 03 23:52:50 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
Wed Feb 03 23:52:53 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
Wed Feb 03 23:53:30 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? i miss you! come back to denver! come back!
Wed Feb 03 23:53:39 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:53:43 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??????
Wed Feb 03 23:53:47 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??????????????
Wed Feb 03 23:53:52 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ????????????????????????????????????
Wed Feb 03 23:53:57 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ????????????????????????????????
Wed Feb 03 23:54:00 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ??????????????????????
Wed Feb 03 23:54:03 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
Wed Feb 03 23:54:06 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? .&gt;?&lt;./
Wed Feb 03 23:54:10 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ?///
Wed Feb 03 23:54:17 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? @nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:54:22 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? &gt;??@nickjonas who would win in a fight, a grilled cheese or a taco?
Wed Feb 03 23:54:31 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? @nickjonas who would win in a fight, a grilled cheese or a taco? ??
Wed Feb 03 23:54:36 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :) :l)
Wed Feb 03 23:54:41 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :0)
Wed Feb 03 23:54:45 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):)
Wed Feb 03 23:54:47 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? &gt;p
Wed Feb 03 23:54:51 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :)
Wed Feb 03 23:54:56 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):):)
Wed Feb 03 23:55:03 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):):)
Wed Feb 03 23:55:12 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? @nickjonas who would win in a fight, a grilled cheese or a taco? ;)
Wed Feb 03 23:55:19 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ;0
Wed Feb 03 23:55:22 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :0
Wed Feb 03 23:55:25 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? ;)
Wed Feb 03 23:55:35 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :):):;
Wed Feb 03 23:55:39 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :-)
Wed Feb 03 23:55:49 +0000 2010	rachelljonas	@nickjonas who would win in a fight, a grilled cheese or a taco? :)_)

raises an interesting point about spam, potentially we don't want to count all the tweets from a user within a small
enough time frame??

#5 18639 cream cheese
<img src="tweets_over_day.60.creamcheese.trending.png"/>
<!--<img src="tweets_over_day.60.creamcheese.trending.zoom.png"/>-->

#412 763 goats cheese
<img src="tweets_over_day.60.goatscheese.trending.png"/>
<!--<img src="tweets_over_day.60.goatscheese.trending.zoom.png"/>-->

#1483 288 apple juice
<img src="tweets_over_day.60.applejuice.trending.png"/>

#1434274 1 bus number

433534 -> 1589981 are all frequency 1




how to allow smaller frequency trends to trump trends of larger frequency items?
while not letting low values to blow everything up 
ie a 'freq' of 5 (from trend value of 2)
perhaps trend value = Math.log10(freq) * (freq/min_trend)

#!/usr/bin/env ruby
['grilledcheese','creamcheese','goatscheese','applejuice'].each do |term|
puts <<EOF
  data = read.delim('tweets_over_day.60.#{term}.trending.tsv', header=FALSE)
  over_trend = data$V2 / data$V4
  normalised_trend = log10(data$V3) * over_trend
  data2 = cbind(data, over_trend, normalised_trend)
  data2[data2$over_trend>1,]
EOF
end


>   data = read.delim('tweets_over_day.60.grilledcheese.trending.tsv', header=FALSE)
     V1  V2       V3       V4 over_trend normalised_trend
230 229 182 32.10435 103.0437   1.766241         2.660955
366 366 179 32.71311 105.6309   1.694580         2.566817
391 391 113 33.32481 107.9641   1.046645         1.593797
392 392 109 33.51786 108.9364   1.000584         1.526167

>   data = read.delim('tweets_over_day.60.creamcheese.trending.tsv', header=FALSE)
     V1  V2       V3       V4 over_trend normalised_trend
221 220  79 25.90045 71.34388   1.107313         1.564973
323 322  78 26.51084 73.97633   1.054391         1.500845
364 363  81 26.93132 75.07515   1.078919         1.543132
377 376 142 27.58886 79.66678   1.782424         2.567999

>   data = read.delim('tweets_over_day.60.goatscheese.trending.tsv', header=FALSE)
     V1 V2       V3       V4 over_trend normalised_trend
44   76  8 1.931818 6.193591   1.291658        0.3693705
205 367  6 1.824390 5.340973   1.123391        0.2933373
223 393  8 1.869955 5.580961   1.433445        0.3896551
268 464  9 1.847015 5.605859   1.605463        0.4278084
289 510 12 1.958478 6.221262   1.928869        0.5630727
301 528  9 1.990033 6.428887   1.399931        0.4183839
382 676  9 1.994764 6.379383   1.410795        0.4230855

>   data = read.delim('tweets_over_day.60.applejuice.trending.tsv', header=FALSE)
     V1 V2       V3       V4 over_trend normalised_trend
13   69  2 1.076923 1.876331   1.065910       0.03430597
14   75  4 1.285714 3.671899   1.089355       0.11889703
117 390  4 1.333333 3.294495   1.214147       0.15169396
205 654  4 1.351220 3.324714   1.203111       0.15727776

seems fair enough..




moving onto pig


TODO

4. per term; mean and std dev comapred to this time previous days
------------------------------------

how can we notice when whether the direction has changed? is this stable?


how does this relate to the daily nature of the data? ie compare to same time a day ago?

how does this relate to the week nature of the data? ie compare to same time a week ago?

how do we do this per term?

how do we do this in pig?

 

